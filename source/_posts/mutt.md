ç»™ç¤¾åŒºå‘é€é‚®ä»¶è®¨è®ºè¡¥ä¸æ—¶ï¼Œé€‰æ‹©ä¸€ä¸ªè¶æ‰‹çš„å®¢æˆ·ç«¯ä¼šæå¤§æé«˜æ²Ÿé€šæ•ˆç‡ã€‚æ›¾ç»æˆ‘é€šè¿‡"git send-email + thunderbird"çš„å·¥å…·ç»„åˆè¿›è¡Œé‚®ä»¶çš„å‘é€å’Œè¯»å–ï¼Œ[thunderbirdå¦‚åŒoutlookçš„cloneç‰ˆæœ¬](https://www.kernel.org/doc/html/v4.10/process/email-clients.html)ï¼Œå¯¹äºä½¿ç”¨GUIå®¢æˆ·ç«¯çš„ç”¨æˆ·æä¸ºå‹å¥½ã€‚ç„¶è€Œå¤§å¤šæ•°å†…æ ¸å¼€å‘è€…è¿˜æ˜¯ä¼šé€‰ç”¨mutté‚®ä»¶å®¢æˆ·ç«¯ï¼Œå…¶å¯é…ç½®æ€§æä½³ï¼Œå®Œå…¨å‘½ä»¤è¡Œçš„äº¤äº’æ–¹å¼å¯¹äºkernel hackeræ¥è¯´æ˜¯æä¸ºå‹å¥½çš„ã€‚

## what is mutt and how dose it work?
> "All mail clients suck. This one just sucks less." -- Michael Elkins, circa 1995

muttæ˜¯ä¸€ä¸ªé‚®ä»¶å®¢æˆ·ç«¯ï¼Œç›´æ¥ä¸ç»ˆç«¯ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼ŒInternetè§„èŒƒå’ŒRFCä½¿ç”¨æœ¯è¯­MUA(Message User Agent)æè¿°é‚®ä»¶å®¢æˆ·ç«¯ã€‚MUAå¯ä»¥æ˜¯æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œå¦‚Microsoft Outlookã€Thunderbirdç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºWebçš„åº”ç”¨ç¨‹åºï¼Œå¦‚Gmailã€Hotmailç­‰ï¼ˆåè€…ä¹Ÿç§°ä¸ºWebmailï¼‰ã€‚ç”¨æˆ·ä½¿ç”¨muttåº”è¯¥èƒ½å¤Ÿå®ŒæˆåŸºæœ¬çš„é‚®ä»¶ç¼–å†™ã€æ¥æ”¶ã€å‘é€ã€‚ä½†muttå°†è¿™äº›åŸºæœ¬åŠŸèƒ½éƒ½æ¨¡å—åŒ–å¹¶äº¤ç»™å…¶ä»–ç¨‹åºå®Œæˆï¼Œå¦‚muttå¯ä»¥é…ç½®ç¯å¢ƒä¸­çš„ç¼–è¾‘å™¨ä½œä¸ºæ’°å†™é‚®ä»¶çš„å·¥å…·ï¼Œæ¯”å¦‚æˆ‘ä¼šé…ç½®è¶æ‰‹çš„vimã€‚ä¸ºäº†ç¡®å®šè¿˜éœ€è¦å“ªäº›è¾…åŠ©ç¨‹åºå¸®åŠ©muttå®ŒæˆåŸºæœ¬çš„é‚®ä»¶æ”¶å‘åŠŸèƒ½ã€‚æˆ‘ä»¬éœ€è¦äº†è§£emailçš„ä¼ é€è¿‡ç¨‹ï¼šä¸ºäº†å°†é‚®ä»¶ä»å‘é€è€…é€šè¿‡Internetä¼ é€’ç»™æ¥æ”¶è€…ï¼Œè¿˜éœ€è¦MTA(Message Transfer Agent)è¿›è¡Œé‚®ä»¶è½¬å‘ï¼Œä¸€ä¸ªç®€ç•¥çš„é‚®ä»¶ä¼ é€æµç¨‹ï¼š
```
sender -> transfer -> recipient
MUA â†’ MTA â†’ â€¦ â†’ MTA â†’ MUA
```
å¯ä»¥å°†ä¸Šè¿°æµç¨‹è¿›è¡Œç»†åŒ–ï¼š
```
push steps: â†’
pull steps: â†’â†’
MUA â†’ MSA â†’ MTA â†’ â€¦ â†’ MTA â†’ MDA â†’â†’ MRA â†’â†’ MUA
```
è¿™é‡Œå¯¹ä¸Šè¿°æœ¯è¯­åšä¸€ä¸ªæ¸…æ™°çš„è§£é‡Šï¼š
* MUA(Message User Agent): MUAæ˜¯ç»ˆç«¯ç”¨æˆ·ç®¡ç†å’Œè¯»å–å­˜å‚¨åˆ°ç”¨æˆ·é‚®ç®±çš„ç”µå­é‚®ä»¶çš„å‰ç«¯ï¼Œå¹¶å¯åœ¨å…¶ä¸­è¿›è¡Œé‚®ä»¶ç¼–è¾‘(compose)ä¸”é€šè¿‡MSAå‘é€å‡ºå»ã€‚
* MTA(Message Transfer Agent)ï¼šMTAå¯¹é‚®ä»¶è¿›è¡Œæ’é˜Ÿ(queue)ã€æ¥æ”¶(receive from)ã€å¹¶å‘é€(send)ç»™ä¸‹ä¸€MTAã€‚è¿™åŒ…æ‹¬é‚®ä»¶è·¯ç”±(routing mail)ã€æ’é˜Ÿ(queuing)å’Œé‡è¯•(retrying)ï¼Œå¦‚æœä¸‹ä¸€MTAæœªèƒ½ç«‹å³æ¥æ”¶æˆ–è€…å¤„ç†emailæˆ–è€…ä¾¿å‘åŸå§‹å‘ä»¶äººå‘é€é€šçŸ¥ã€‚
* MSA(Message Submission Agent)ï¼šæ¥æ”¶æ¥è‡ªMUAå‘é€çš„é‚®ä»¶ï¼Œä½œä¸ºSMTP clientï¼Œä»…èƒ½å‘é€emailï¼Œè€Œä¸èƒ½åƒFull-fledged MTAæ¥æ”¶emailè¿›è¡Œè½¬å‘ã€‚MTAä½¿ç”¨ç«¯å£25ï¼ŒMSAä¸ä»…å¯ä»¥ä½¿ç”¨ç«¯å£25ï¼Œè¿˜æœ‰offical port 587ã€‚MSAä½¿ç”¨ESMTP(SMTPåè®®çš„å˜ç§)ã€‚MSAæœ‰æ—¶å€™ä¹Ÿå½¢è±¡åœ°ç§°ä¸ºMail Sending Agentã€‚
* MDA(Message Delivery Agent)ï¼šMDAæ”¶åˆ°é‚®ä»¶ä¹‹åä¸ä¼šå¾€ä¸‹è½¬å‘ï¼Œå³é‚®ä»¶å·²ç»æŠ•é€’åˆ°ä½ã€‚MDAå°†é‚®ä»¶æ”¾å…¥æ”¶ä»¶ç®±(incoming mailbox)ï¼ŒMDAå¯ä»¥è°ƒç”¨`procmail`
* MRA(Mail Retrieval Agent)ï¼šä¸è¿œç¨‹é‚®ç®±å»ºç«‹è¿æ¥å¹¶è·å–é‚®ä»¶åˆ°æœ¬åœ°ä½¿ç”¨ï¼ŒMRAæ˜¯ä»é‚®ä»¶æ¥æ”¶è€…çš„è§†è§’æ¥å‘½åï¼ŒIETFä¸æ”¯æŒè¯¥æœ¯è¯­ï¼Œè®¤ä¸ºå…¶æ˜¯MUA[1]ã€‚

è‹¥æ˜¯è¦é€šè¿‡muttå®Œæˆé‚®ä»¶çš„æ”¶å‘ï¼Œè¿˜éœ€è¦å…·å¤‡MSAå’ŒMRAåŠŸèƒ½çš„è½¯ä»¶é…åˆmuttã€‚æ˜¾ç„¶ï¼Œåœ¨æˆ‘ä»¬å·¥ä½œçš„å®¢æˆ·ç«¯ä¸éœ€è¦Full-fledeged MTAå®Œæˆé‚®ä»¶çš„ä¸­è½¬ï¼Œæˆ‘ä»¬ä»…éœ€å°†é‚®ä»¶å‘å‡ºå³å¯ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦MDAå¯¹é‚®ä»¶è¿›è¡ŒæŠ•é€’ï¼ˆå¦‚æœæ‚¨æ˜¯ä¸ºä¸ªäººæˆ–è€…å…¬å¸æ­å»ºé‚®ä»¶æœåŠ¡å™¨ï¼Œå°±å½“æˆ‘æ²¡è¯´ğŸ™Šï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„é‚®ç®±ï¼Œè¯¸å¦‚Gmailçš„é‚®ä»¶æœåŠ¡å™¨å·²ç»å®Œæˆé‚®ä»¶æŠ•é€’å·¥ä½œï¼Œæˆ‘ä»¬ä»…éœ€é€šè¿‡POP3/IMAPåè®®æ¥æ”¶é‚®ä»¶ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬é€šè¿‡æœç´¢å¼•æ“é…ç½®æœç´¢muttçš„é…ç½®ï¼Œç»å¸¸ä¼šå‡ºç°å„ç§`mutt + x + y + ...`çš„æœç´¢ç»“æœä»¤äººçœ¼èŠ±ç¼­ä¹±ã€‚è¿™æ˜¯å› ä¸ºåŒä¸€åŠŸèƒ½ï¼Œä½ çš„é€‰æ‹©å¾ˆå¤šï¼Œå°±æ‹¿MSAæ¥è¯´ï¼Œæ‚¨å¯ä»¥é€‰æ‹©`postfix`ã€`sendmail`ã€`msmtp`ç­‰[2]ã€‚è€Œä¸”ï¼ŒåŒä¸€è½¯ä»¶å…·å¤‡çš„å¤šç§åŠŸèƒ½ï¼Œå¦‚`sendmail`ã€`postfix`ä¸ä»…å…·æœ‰MTAåŠŸèƒ½ï¼Œè¿˜é›†æˆäº†MDAåŠŸèƒ½ã€‚ğŸ˜¤å®³ï¼Œè¿™ä¸æ˜¯è¿èƒŒäº†Unixå“²å­¦"one task per tool"ï¼æ˜¯çš„ï¼Œç”šè‡³è¿muttä¹ŸèƒŒç¦»åˆå¿ƒ:
> mutt was developed with the concept of "one task per tool", enabling performance through combination with other high quality modular programs. 

ä½†æ˜¯muttç°åœ¨å®é™…å˜æˆäº†å½“åˆå®ƒè®¨åŒçš„æ ·å­ğŸ˜…ï¼š
> ... or why mutt should not but slowly becomes an "all-in-1" program.

muttå·²ç»å¼•å…¥äº†æœ€ç®€å•çš„MRAã€MSAåŠŸèƒ½æ”¯æŒSMTPã€POP3ã€IMAPè¿›è¡Œé‚®ä»¶æ”¶å‘ã€‚ä¸ºä½•ä¼šèƒŒç¦»åˆå¿ƒï¼š
> "This entire concept is rubbish and the mutt developers are just plain lazy [to add all the good stuff]."

å¥½å§ï¼Œçœ‹æ¥ç¾¤ä¼—çš„åŠ›é‡æ˜¯å¾ˆéš¾æ‰¿å—çš„â€¦â€¦
å¦å¤–æœ‰äº›åŠŸèƒ½çš„ç•Œé™å®é™…éš¾ä»¥åŒºåˆ†ï¼Œæ¯”å¦‚MDAå’ŒMRAã€‚

OK, è¯´äº†è¿™ä¹ˆå¤šå…³äºé‚®ä»¶çš„åŸºæœ¬æ¦‚å¿µï¼Œlet's get hands dirtyï¼Œç¬¬ä¸€æ­¥å…ˆå®‰è£…muttï¼ˆæœ¬æ–‡ä½¿ç”¨CentOS8ç¯å¢ƒï¼ŒUbuntuç”¨æˆ·åº”è¯¥ä¼šæ›´æ–¹ä¾¿ï¼‰:
```bash
yum install mutt
```

## Basic Configuration
mutté»˜è®¤ä»ç³»ç»ŸèŒƒå›´çš„é…ç½®æ–‡ä»¶ï¼ˆâ€œ/etc/Muttrcâ€ï¼‰è¯»å–å…¶é…ç½®çš„é»˜è®¤å€¼ï¼Œè¯¥æ–‡ä»¶é€šå¸¸æ§åˆ¶ç³»ç»Ÿè®¾ç½®å¹¶ä¸ºæ‰€æœ‰ç”¨æˆ·æä¾›å¯è¡Œçš„é»˜è®¤é…ç½®ã€‚ç„¶åè¯»å–ä¸ªäººé…ç½®æ–‡ä»¶ï¼ˆâ€œ~/.muttrcâ€æˆ–â€œ~/.mutt/muttrcâ€ï¼‰ï¼Œè¿™æ ·ï¼Œä¸ªäººè®¾ç½®ä¼šæ ¹æ®éœ€è¦è¦†ç›–ç³»ç»Ÿè®¾ç½®ã€‚æˆ‘ä»¬é‡‡ç”¨`~/.mutt/muttrc`å¯¹muttè¿›è¡Œé…ç½®ã€‚

muttä¸­çš„å˜é‡é€šè¿‡`set var=value`æ–¹å¼é…ç½®ã€‚å­˜åœ¨ä»…éœ€è®¾ç½®yes/noçš„`toggle var`ï¼ˆå¸ƒå°”å˜é‡ï¼‰ï¼Œä½ å¯ä»¥ä¸º`toggle var`è®¾ç½®"ask-yes"æˆ–è€…"ask-no"ä»¥æŒ‡å®šæ¯æ¬¡ä½¿ç”¨æ—¶ç»™å®šé»˜è®¤ç­”æ¡ˆè¿›è¡Œæç¤ºã€‚ä¹Ÿå¯ä»¥é€šè¿‡ "unset"ã€"set var"ã€"set novar"ç®€åŒ–å¸ƒå°”å˜é‡çš„è®¾ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ é…ç½®çš„muttå˜é‡å¯¹åº”çš„åŠŸèƒ½åœ¨ç¼–è¯‘muttæ—¶å·²å¯ç”¨æ‰ä¼šæˆåŠŸè®¾ç½®ï¼Œå¦åˆ™ä½ ä¼šå¾—åˆ°â€œunknown variableâ€çš„å‘Šè­¦ã€‚ä¸‹é¢ç»™å‡ºæœ€åŸºæœ¬çš„mutté…ç½®ï¼š

`ssl_force_tls`è¡¨ç¤ºmuttä¸æ‰€æœ‰çš„è¿œç«¯æœåŠ¡å™¨çš„è¿æ¥éœ€è¦é€šè¿‡TLSåè®®åŠ å¯†ï¼Œå¦‚æœä¸èƒ½æˆåŠŸå»ºç«‹è¿æ¥ï¼Œä¸­æ–­é€šä¿¡ã€‚éœ€è¦é€šè¿‡`mutt -v | grep tls`èƒ½å¤Ÿæ‰“å°`--with-gnutls`è¡¨ç¤ºmuttæ”¯æŒTLSã€‚

`abort_nosubject`çš„é»˜è®¤å€¼æ˜¯"ask-yes"ï¼Œè¡¨ç¤ºæˆ‘ä»¬å‘é€é‚®ä»¶è¿˜æœªå†™é‚®ä»¶ä¸»é¢˜æ—¶ï¼Œè¯¥é…ç½®å°†ä¼šæç¤ºï¼Œé»˜è®¤å€¼ä¸º"yes"ã€‚å°†è¯¥é¡¹è®¾ç½®ä¸º"no"ï¼Œä¾¿æ— éœ€ç¡®è®¤ã€‚

muttæ¯æ¬¡æ¥æ”¶åˆ°é”®ç›˜è¾“å…¥æ—¶ä¾¿ä¼šæ›´æ–°æ‰€æœ‰ç›®å½•çš„çŠ¶æ€ã€‚æˆ‘ä»¬ä¹Ÿå¸Œæœ›å³ä½¿åœ¨ç©ºé—²æ—¶ä¹Ÿèƒ½æ”¶åˆ°æ–°é‚®ä»¶çš„é€šçŸ¥ï¼Œè€Œä¸éœ€è¦æŒ‰ä¸‹æŒ‰é”®ã€‚æ§åˆ¶è¿™ç§è¡Œä¸ºçš„å˜é‡æ˜¯`timeout`ã€‚å®ƒè¡¨ç¤ºç­‰å¾…ç”¨æˆ·è¾“å…¥çš„æœ€å¤§æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚å¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°ç”¨æˆ·è¾“å…¥ï¼Œä¾¿æ‰§è¡Œæ›´æ–°æ“ä½œã€‚å˜é‡çš„é»˜è®¤å€¼æ˜¯600ç§’ï¼Œè¡¨ç¤ºåœ¨æ²¡æœ‰è¾“å…¥çš„æƒ…å†µä¸‹ï¼Œæ¯10åˆ†é’Ÿæ¥æ”¶ä¸€æ¬¡æ›´æ–°ã€‚é»˜è®¤å€¼å¤ªé«˜ï¼Œæˆ‘ä»¬è®¾ç½®ä¸º10ã€‚

å¦‚å‰æ‰€è¿°ï¼Œæ¯æ¬¡æ”¶åˆ°ç”¨æˆ·è¾“å…¥æ—¶ï¼Œmuttéƒ½ä¼šæŸ¥æ‰¾æ›´æ–°ã€‚é”®ç›˜æ´»åŠ¨å¤ªé¢‘ç¹ä¼šå¯¼è‡´è¿‡å¤šçš„è®¿é—®æ“ä½œï¼Œä¸ºäº†é™åˆ¶è¿™ä¸ªé¢‘ç‡ï¼Œä½¿ç”¨`mail check`å˜é‡ã€‚è¯¥å˜é‡è¡¨ç¤ºä¸¤æ¬¡æ‰«æä¹‹é—´çš„æœ€å°æ—¶é—´(ä»¥ç§’ä¸ºå•ä½)ã€‚è¯¥å˜é‡çš„é»˜è®¤å€¼æ˜¯5ï¼Œå³ä½¿ç»å¸¸æŒ‰ä¸‹é”®ï¼Œmuttä¹Ÿå°†æ¯5ç§’æœç´¢ä¸€æ¬¡æ–°é‚®ä»¶ã€‚è¯¥å€¼è¿˜æ˜¯å¤ªå°ï¼Œå°¤å…¶æ˜¯åœ¨å¤šé‚®ç®±çš„åœºæ™¯ä¸‹ï¼Œå¯èƒ½å› ä¸ºé¢‘ç¹è®¿é—®é™ä½é€Ÿåº¦ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¢å¼•èœå•(æ˜¾ç¤ºæ¶ˆæ¯åˆ—è¡¨)ä¸­çš„ç”µå­é‚®ä»¶æŒ‰æ—¥æœŸå‡åºæ’åºï¼Œå› æ­¤æ›´æ–°çš„ç”µå­é‚®ä»¶å°†æ˜¾ç¤ºåœ¨åº•éƒ¨ã€‚è¦æ›´æ”¹ç”µå­é‚®ä»¶çš„æ’åºæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å’Œè®¾ç½®`sort`å˜é‡çš„å€¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®`reverse-data-received`è®©æ›´æ–°çš„ç”µå­é‚®ä»¶å‡ºç°åœ¨åˆ—è¡¨çš„é¡¶éƒ¨ã€‚å…¶ä»–å‚æ•°ä¹Ÿå¯ä»¥ç”¨ä½œæ’åºå› å­ï¼Œä¾‹å¦‚subjectå’Œsizeã€‚


## Retrieve email
MUAä½¿ç”¨POP3/IMAPåè®®ä»é‚®ä»¶æœåŠ¡å™¨ä¸‹è½½é‚®ä»¶ã€‚ä¸¤è€…çš„åŒºåˆ«å¦‚ä¸‹[3]ï¼š
* POP3(Post Office Protocol 3)ï¼šä»…ä»…ä¸‹è½½é‚®ä»¶æœåŠ¡å™¨çš„inboxç›®å½•ä¸­çš„é‚®ä»¶åˆ°æœ¬åœ°ï¼Œä¸ä¼šä¸‹è½½sentã€draftã€deletedç›®å½•ä¸‹çš„é‚®ä»¶ã€‚å¹¶ä¸”POP3ä¸ä¼šåŒæ­¥ï¼Œå¹¶ä¸”å½“emailè¢«ä¸‹è½½åˆ°ä¸€å°è®¾å¤‡ä¸Šæ—¶ï¼Œemailä¼šä»é‚®ä»¶æœåŠ¡å™¨ä¸­åˆ é™¤ã€‚
* IMAP(Internet Message Access Protocol)ï¼šå…è®¸åœ¨å¤šä¸ªå®¢æˆ·ç«¯ä¸ŠæŸ¥çœ‹é‚®ä»¶ï¼ˆåŒæ­¥ï¼‰ï¼ŒIMAPä¼šå°†é‚®ä»¶ç¼“å­˜åˆ°æœ¬åœ°ã€‚IMAPè¿˜ä¼šåŒæ­¥å„ä¸ªè®¾å¤‡çš„ç›®å½•ç»“æ„

{% asset_img POP3.png %}
ä¸Šå›¾å±•ç¤ºäº†ä¸¤å°ç”µè„‘éƒ½ä»åŒä¸€emailè´¦å·ä¸‹è½½é‚®ä»¶ï¼ˆå‡ä½¿ç”¨POP3åè®®ï¼‰ï¼Œä¸¤å°ç”µè„‘ä¸Šçš„ç›®å½•ç»“æ„æˆªç„¶ä¸åŒï¼Œå› ä¸ºPOP3ä¸ä¼šåŒæ­¥ä¸¤å°ç”µè„‘ä¸­çš„ç›®å½•ã€‚å½“æœ‰æ–°é‚®ä»¶åˆ°æ¥æ—¶ï¼Œç¬¬ä¸€å°ç”µè„‘å…ˆä¸‹è½½äº†é‚®ä»¶ï¼Œé‚®ä»¶ä¾¿ä¼šä»é‚®ä»¶æœåŠ¡å™¨ä¸­åˆ é™¤ï¼Œç¬¬äºŒèƒç”µè„‘æ˜¯è·å–ä¸åˆ°æ–°é‚®ä»¶çš„ã€‚ä¸è¿‡åé¢è¿™ä¸ªé—®é¢˜è¿˜å¥½ï¼Œå¾ˆå¤šé‚®ä»¶å®¢æˆ·ç«¯å¯ä»¥è®¾ç½®`leave a copy of messages on the server`ã€‚

POP3å’ŒIMAPçš„æ¯”è¾ƒï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š
| metrics |  POP3  | IMAP |
| -- | -- | -- |
| view without Internet | Yes | NO |
| All the folders can be seen | NO | YES |
| All the folders and emails are synchronized | NO | YES |
| Email stored on the mail server | NO | YES |

ç”±äºIMAPé»˜è®¤åœ¨æœ¬åœ°ä»…ç¼“å­˜(cache)é‚®ä»¶ï¼Œå¹¶ä¸ä¸‹è½½é‚®ä»¶ï¼Œæ‰€ä»¥é»˜è®¤åœ¨æ— ç½‘ç»œçš„æ¡ä»¶ä¸‹ï¼Œä½¿ç”¨IMAPçš„MUAæ˜¯æ— æ³•é˜…è¯»é‚®ä»¶çš„ï¼Œä½†æ˜¯ç°åœ¨å¾ˆå¤šä½¿ç”¨IMAPçš„MUAéƒ½å¯ä»¥è®¾ç½®å°†é‚®ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè€Œéä»…ä»…ç¼“å­˜ã€‚
POP3åè®®ç”±äºä¼šå°†é‚®ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼ˆä¸‹è½½ä¼šåˆ é™¤é‚®ä»¶æœåŠ¡å™¨ä¸­çš„é‚®ä»¶ï¼‰ï¼Œä»è€Œèƒ½å¤ŸèŠ‚çº¦é‚®ä»¶æœåŠ¡å™¨çš„ç©ºé—´ï¼Œç„¶è€Œæœ¬åœ°ä¸‹è½½çš„é‚®ä»¶éœ€è¦å¤‡ä»½ä»¥å…ç£ç›˜æŸåé‚®ä»¶ä¸¢å¤±ã€‚

muttå·²ç»æ”¯æŒIMAPï¼ŒéªŒè¯å½“å‰ç‰ˆæœ¬muttæ˜¯å¦æ”¯æŒIMAPï¼š
```bash
[root@localhost ~]# mutt -v | grep IMAP
+USE_POP  +USE_IMAP  +USE_SMTP  
```
æ˜¾ç„¶ï¼Œå½“å‰muttç‰ˆæœ¬å·²ç»æ”¯æŒIMAPã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨muttè‡ªå¸¦çš„IMAPåŠŸèƒ½ä¸‹è½½é‚®ä»¶ã€‚



## Send email
MTAè¿›è¡Œé‚®ä»¶è½¬å‘ä½¿ç”¨SMTPåè®®(Simple Mail Transfer Protocol)ã€‚å¦‚ä¸‹è¿™æ®µè¯ï¼Œæˆ‘è®¤ä¸ºæ˜¯å¯¹SMTPåè®®çš„åŠŸèƒ½çš„ä¸€ä¸ªè‰¯å¥½æ¦‚æ‹¬[4]ã€‚
> SMTP is basically a set of commands that authenticates and directs the transfer of email

æ›´ç®€å•æ–¹å¼çš„è®°ä½S(ending) M(ail) T(o) P(eople)ã€‚ä¸‹å›¾å±•ç¤ºäº†é€šè¿‡SMTPåè®®å°†é‚®ä»¶ä»SMTP clienté€”å¾„SMTP serverä¼ é€’åˆ°æ”¶ä»¶äººçš„SMTP serverï¼Œæœ€ç»ˆæ”¶ä»¶ç”¨æˆ·ç™»å½•ä¿¡ç®±é€šè¿‡POP3/IMAPä¸‹è½½é‚®ä»¶ã€‚
{% asset_img smtp.png %}

MTAå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šä»…è½¬å‘(relay-only)ã€å…¨åŠŸèƒ½(full-fledged)[5]ã€‚
* Relay-only MTAs: æˆ–è€…ç§°ä¸ºSend-only MTAsã€small MTAs(SMTP clients)[6]ï¼Œæ­¤ç±»MTAä»…å°†ä½ çš„emailè½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¦‚æœä½ åƒæˆ‘ä¸€æ ·ä»…ä»…æƒ³å‘é€è‡ªå·±çš„Gmailé‚®ä»¶ï¼Œæ­¤ç±»MTAæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚SMTP clientä»…æ‰§è¡ŒæŸäº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œè€Œä¸åƒFull-fledged MTAä¸€æ ·è¿è¡Œå®Œæˆçš„SMTPæœåŠ¡å™¨ï¼Œå ç”¨å¤§é‡çš„èµ„æºå¼€é”€ã€‚è¿™æ ·çš„MTAä¸ä¼šç›‘å¬ä¼ å…¥çš„æ¶ˆæ¯ï¼Œå°½åœ¨éœ€è¦å‘é€é‚®ä»¶çš„æ—¶å€™è¿è¡Œã€‚small MTAé€šå¸¸ä½œä¸ºMSAå³é‚®ä»¶å‘é€çš„ç¬¬ä¸€ç«™ã€‚
* Full-fledged MTAsï¼šä¹Ÿç§°ä¸ºmail hubï¼Œèƒ½å¤Ÿå¤„ç†Interneté‚®ä»¶ä¼ é€çš„æ‰€æœ‰ç»†èŠ‚ï¼Œé€šå¸¸è¿™ç±»MTAä»Relay-Only MTAæ¥æ”¶é‚®ä»¶å†è¿›è¡Œè½¬å‘ã€‚é‚®ä»¶åœ¨Internetçš„ä¸­é—´MTAè½¬å‘æ¼«æ¸¸æ—¶ï¼Œè¿™äº›MTAä½¿ç”¨full-fledged MTAæ¯”è¾ƒåˆé€‚ã€‚

æœ¬æ–‡ä»…è€ƒè™‘MSAå³Relay-only MTAï¼Œé€‰å–è½¯ä»¶ä½œä¸ºMSAåº”è¯¥è€ƒè™‘å¦‚ä¸‹å› ç´ ï¼š
* MTAæ˜¯å¦å¯ä»¥å¯¹é‚®ä»¶è¿›è¡Œæ’é˜Ÿï¼Œä»¥ä¾¿åœ¨å‡ºç°æ•…éšœæ—¶ç¨åå‘é€
* MTAå¯ä»¥å–ä»£MDA?å¦‚æœå¯ä»¥ï¼Œå®ƒå°†å¤„ç†æ¥è‡ªç³»ç»Ÿçš„æ‰€æœ‰é‚®ä»¶ã€‚
* MTAæ˜¯å¦æ”¯æŒè¿æ¥åˆ°ISP SMTPæœåŠ¡å™¨çš„è¦æ±‚ï¼Ÿè¿™äº›è¦æ±‚å¯èƒ½åŒ…æ‹¬ç‰¹å®šçš„èº«ä»½éªŒè¯æˆ–TLSã€‚

muttæ—©å·²æ”¯æŒESMTP/SMTPï¼ŒéªŒè¯å½“å‰æ‚¨ä½¿ç”¨çš„muttæ˜¯å¦æ”¯æŒSMTP:
```bash
[root@localhost ~]# mutt -v | grep SMTP
+USE_POP  +USE_IMAP  +USE_SMTP
```
æ˜¾ç„¶ï¼Œå½“å‰muttç‰ˆæœ¬å·²ç»æ”¯æŒSMTPã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨muttè‡ªå¸¦çš„SMTPåŠŸèƒ½è¿›è¡Œé‚®ä»¶å‘é€ï¼Œæ­¤æ—¶ï¼Œmuttè‡ªå·±å¯ä»¥ä½œä¸ºMSAã€‚å¦‚æœæ‚¨éœ€è¦é€‰æ‹©åŠŸèƒ½æ›´ä¸ºå¤æ‚çš„MSAï¼Œè¯·å‚è€ƒ[SendmailAgents](https://gitlab.com/muttmua/mutt/-/wikis/SendmailAgents)ã€‚



## Reference
[1] Email agent (infrastructure) https://en.wikipedia.org/wiki/Email_agent_(infrastructure)#cite_note-modularmonolithic-schroder-1
[2] SendmailAgents https://gitlab.com/muttmua/mutt/-/wikis/SendmailAgents
[3] POP3 vs IMAP - What's the difference? https://www.youtube.com/watch?v=SBaARws0hy4&t=337s
[4] What is SMTP - Simple Mail Transfer Protocol https://www.youtube.com/watch?v=PJo5yOtu7o8
[5] Postfix vs. Sendmail vs. Exim https://blog.mailtrap.io/postfix-sendmail-exim/?amp=1
[6] MTA: Mail Transport Agent (SMTP server) https://gitlab.com/muttmua/mutt/-/wikis/MailConcept